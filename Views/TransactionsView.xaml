<UserControl x:Class="doc_bursa.Views.TransactionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:doc_bursa.ViewModels"
             xmlns:cvt="clr-namespace:doc_bursa.Converters">
    <UserControl.Resources>
        <cvt:AmountToColorConverter x:Key="AmountToColorConverter"/>
    </UserControl.Resources>

    <UserControl.DataContext>
        <vm:TransactionsViewModel/>
    </UserControl.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Text="Транзакції" 
                  FontSize="28" 
                  FontWeight="SemiBold" 
                  Margin="0,0,0,20"/>

        <Grid Grid.Row="1" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>

            <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                    Style="{StaticResource SearchBoxStyle}"
                    Margin="0,0,10,0"/>

            <ComboBox Grid.Column="1" 
                     ItemsSource="{Binding Categories}" 
                     SelectedItem="{Binding SelectedCategory}"/>
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,10">
            <Button Content="◀" Width="40" Command="{Binding PreviousPageCommand}"/>
            <TextBlock Text="{Binding CurrentPage, StringFormat='Сторінка {0}'}" Margin="10,0"/>
            <TextBlock Text="{Binding TotalPages, StringFormat='з {0}'}"/>
            <Button Content="▶" Width="40" Command="{Binding NextPageCommand}" Margin="10,0,0,0"/>
        </StackPanel>

        <Border Grid.Row="3" Style="{StaticResource CardStyle}">
            <DataGrid ItemsSource="{Binding Transactions}" 
                     SelectedItem="{Binding SelectedTransaction}"
                     AutoGenerateColumns="False"
                     CanUserAddRows="False"
                     IsReadOnly="True"
                     EnableRowVirtualization="True"
                     EnableColumnVirtualization="True"
                     VirtualizingPanel.IsVirtualizing="True"
                     VirtualizingPanel.VirtualizationMode="Recycling"
                     VirtualizingPanel.CacheLength="20,20"
                     VirtualizingPanel.CacheLengthUnit="Item"
                     GridLinesVisibility="None"
                     HeadersVisibility="Column"
                     Background="White"
                     BorderThickness="0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Дата" 
                                       Binding="{Binding Date, StringFormat='dd.MM.yyyy'}" 
                                       Width="100"/>
                    <DataGridTextColumn Header="Опис" 
                                       Binding="{Binding Description}" 
                                       Width="*"/>
                    <DataGridTextColumn Header="Категорія" 
                                       Binding="{Binding Category}" 
                                       Width="150"/>
                    <DataGridTextColumn Header="Сума" 
                                       Binding="{Binding Amount, StringFormat='{}{0:N2} ₴'}" 
                                       Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="{Binding Amount, Converter={StaticResource AmountToColorConverter}}"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Джерело" 
                                       Binding="{Binding Source}" 
                                       Width="100"/>
                </DataGrid.Columns>

                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Змінити категорію">
                            <MenuItem Header="Продукти" Command="{Binding UpdateCategoryCommand}" CommandParameter="Продукти"/>
                            <MenuItem Header="Транспорт" Command="{Binding UpdateCategoryCommand}" CommandParameter="Транспорт"/>
                            <MenuItem Header="Ресторани" Command="{Binding UpdateCategoryCommand}" CommandParameter="Ресторани"/>
                            <MenuItem Header="Здоров'я" Command="{Binding UpdateCategoryCommand}" CommandParameter="Здоров'я"/>
                            <MenuItem Header="Розваги" Command="{Binding UpdateCategoryCommand}" CommandParameter="Розваги"/>
                            <MenuItem Header="Інше" Command="{Binding UpdateCategoryCommand}" CommandParameter="Інше"/>
                        </MenuItem>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
